(function(){function e(e){var n=!1;return function(){if(n)throw Error("Callback was already called.");n=!0,e.apply(t,arguments)}}var t,n,i={};t=this,null!=t&&(n=t.async),i.noConflict=function(){return t.async=n,i};var r=function(e,t){if(e.forEach)return e.forEach(t);for(var n=0;e.length>n;n+=1)t(e[n],n,e)},o=function(e,t){if(e.map)return e.map(t);var n=[];return r(e,function(e,i,r){n.push(t(e,i,r))}),n},a=function(e,t,n){return e.reduce?e.reduce(t,n):(r(e,function(e,i,r){n=t(n,e,i,r)}),n)},c=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};i.nextTick="undefined"!=typeof process&&process.nextTick?process.nextTick:"function"==typeof setImmediate?function(e){setImmediate(e)}:function(e){setTimeout(e,0)},i.each=function(t,n,i){if(i=i||function(){},!t.length)return i();var o=0;r(t,function(r){n(r,e(function(e){e?(i(e),i=function(){}):(o+=1,o>=t.length&&i(null))}))})},i.forEach=i.each,i.eachSeries=function(e,t,n){if(n=n||function(){},!e.length)return n();var r=0,o=function(){var a=!0;t(e[r],function(t){t?(n(t),n=function(){}):(r+=1,r>=e.length?n(null):a?i.nextTick(o):o())}),a=!1};o()},i.forEachSeries=i.eachSeries,i.eachLimit=function(e,t,n,i){var r=u(t);r.apply(null,[e,n,i])},i.forEachLimit=i.eachLimit;var u=function(e){return function(t,n,i){if(i=i||function(){},!t.length||0>=e)return i();var r=0,o=0,a=0;(function c(){if(r>=t.length)return i();for(;e>a&&t.length>o;)o+=1,a+=1,n(t[o-1],function(e){e?(i(e),i=function(){}):(r+=1,a-=1,r>=t.length?i():c())})})()}},s=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[i.each].concat(t))}},l=function(e,t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[u(e)].concat(n))}},f=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[i.eachSeries].concat(t))}},h=function(e,t,n,i){var r=[];t=o(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n,i){r[e.index]=i,t(n)})},function(e){i(e,r)})};i.map=s(h),i.mapSeries=f(h),i.mapLimit=function(e,t,n,i){return d(t)(e,n,i)};var d=function(e){return l(e,h)};i.reduce=function(e,t,n,r){i.eachSeries(e,function(e,i){n(t,e,function(e,n){t=n,i(e)})},function(e){r(e,t)})},i.inject=i.reduce,i.foldl=i.reduce,i.reduceRight=function(e,t,n,r){var a=o(e,function(e){return e}).reverse();i.reduce(a,t,n,r)},i.foldr=i.reduceRight;var m=function(e,t,n,i){var r=[];t=o(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n&&r.push(e),t()})},function(){i(o(r.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};i.filter=s(m),i.filterSeries=f(m),i.select=i.filter,i.selectSeries=i.filterSeries;var p=function(e,t,n,i){var r=[];t=o(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n||r.push(e),t()})},function(){i(o(r.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};i.reject=s(p),i.rejectSeries=f(p);var _=function(e,t,n,i){e(t,function(e,t){n(e,function(n){n?(i(e),i=function(){}):t()})},function(){i()})};i.detect=s(_),i.detectSeries=f(_),i.some=function(e,t,n){i.each(e,function(e,i){t(e,function(e){e&&(n(!0),n=function(){}),i()})},function(){n(!1)})},i.any=i.some,i.every=function(e,t,n){i.each(e,function(e,i){t(e,function(e){e||(n(!1),n=function(){}),i()})},function(){n(!0)})},i.all=i.every,i.sortBy=function(e,t,n){i.map(e,function(e,n){t(e,function(t,i){t?n(t):n(null,{value:e,criteria:i})})},function(e,t){if(e)return n(e);var i=function(e,t){var n=e.criteria,i=t.criteria;return i>n?-1:n>i?1:0};n(null,o(t.sort(i),function(e){return e.value}))})},i.auto=function(e,t){t=t||function(){};var n=c(e);if(!n.length)return t(null);var o={},u=[],s=function(e){u.unshift(e)},l=function(e){for(var t=0;u.length>t;t+=1)if(u[t]===e)return u.splice(t,1),void 0},f=function(){r(u.slice(0),function(e){e()})};s(function(){c(o).length===n.length&&(t(null,o),t=function(){})}),r(n,function(n){var r=e[n]instanceof Function?[e[n]]:e[n],c=function(e){if(e)t(e),t=function(){};else{var r=Array.prototype.slice.call(arguments,1);1>=r.length&&(r=r[0]),o[n]=r,i.nextTick(f)}},u=r.slice(0,Math.abs(r.length-1))||[],h=function(){return a(u,function(e,t){return e&&o.hasOwnProperty(t)},!0)&&!o.hasOwnProperty(n)};if(h())r[r.length-1](c,o);else{var d=function(){h()&&(l(d),r[r.length-1](c,o))};s(d)}})},i.waterfall=function(e,t){if(t=t||function(){},!e.length)return t();var n=function(e){return function(r){if(r)t.apply(null,arguments),t=function(){};else{var o=Array.prototype.slice.call(arguments,1),a=e.next();a?o.push(n(a)):o.push(t),i.nextTick(function(){e.apply(null,o)})}}};n(i.iterator(e))()};var v=function(e,t,n){if(n=n||function(){},t.constructor===Array)e.map(t,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);1>=n.length&&(n=n[0]),t.call(null,e,n)})},n);else{var i={};e.each(c(t),function(e,n){t[e](function(t){var r=Array.prototype.slice.call(arguments,1);1>=r.length&&(r=r[0]),i[e]=r,n(t)})},function(e){n(e,i)})}};i.parallel=function(e,t){v({map:i.map,each:i.each},e,t)},i.parallelLimit=function(e,t,n){v({map:d(t),each:u(t)},e,n)},i.series=function(e,t){if(t=t||function(){},e.constructor===Array)i.mapSeries(e,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);1>=n.length&&(n=n[0]),t.call(null,e,n)})},t);else{var n={};i.eachSeries(c(e),function(t,i){e[t](function(e){var r=Array.prototype.slice.call(arguments,1);1>=r.length&&(r=r[0]),n[t]=r,i(e)})},function(e){t(e,n)})}},i.iterator=function(e){var t=function(n){var i=function(){return e.length&&e[n].apply(null,arguments),i.next()};return i.next=function(){return e.length-1>n?t(n+1):null},i};return t(0)},i.apply=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var E=function(e,t,n,i){var r=[];e(t,function(e,t){n(e,function(e,n){r=r.concat(n||[]),t(e)})},function(e){i(e,r)})};i.concat=s(E),i.concatSeries=f(E),i.whilst=function(e,t,n){if(e()){var r=!0;t(function(o){return o?n(o):(r?i.nextTick(function(){i.whilst(e,t,n)}):i.whilst(e,t,n),void 0)}),r=!1}else n()},i.doWhilst=function(e,t,n){var r=!0;e(function(o){return o?n(o):(t()?r?i.nextTick(function(){i.doWhilst(e,t,n)}):i.doWhilst(e,t,n):n(),void 0)}),r=!1},i.until=function(e,t,n){if(e())n();else{var r=!0;t(function(o){return o?n(o):(r?i.nextTick(function(){i.until(e,t,n)}):i.until(e,t,n),void 0)}),r=!1}},i.doUntil=function(e,t,n){var r=!0;e(function(o){return o?n(o):(t()?n():r?i.nextTick(function(){i.doUntil(e,t,n)}):i.doUntil(e,t,n),void 0)}),r=!1},i.queue=function(t,n){function o(e,t,o,a){t.constructor!==Array&&(t=[t]),r(t,function(t){var r={data:t,callback:"function"==typeof a?a:null};o?e.tasks.unshift(r):e.tasks.push(r),e.saturated&&e.tasks.length===n&&e.saturated(),i.nextTick(e.process)})}var a=0,c={tasks:[],concurrency:n,saturated:null,empty:null,drain:null,push:function(e,t){o(c,e,!1,t)},unshift:function(e,t){o(c,e,!0,t)},process:function(){if(c.concurrency>a&&c.tasks.length){var n=c.tasks.shift();c.empty&&0===c.tasks.length&&c.empty(),a+=1;var r=!0,o=function(){a-=1,n.callback&&n.callback.apply(n,arguments),c.drain&&0===c.tasks.length+a&&c.drain(),c.process()},u=e(function(){var e=arguments;r?i.nextTick(function(){o.apply(null,e)}):o.apply(null,arguments)});t(n.data,u),r=!1}},length:function(){return c.tasks.length},running:function(){return a}};return c},i.cargo=function(e,t){var n=!1,a=[],c={tasks:a,payload:t,saturated:null,empty:null,drain:null,push:function(e,n){e.constructor!==Array&&(e=[e]),r(e,function(e){a.push({data:e,callback:"function"==typeof n?n:null}),c.saturated&&a.length===t&&c.saturated()}),i.nextTick(c.process)},process:function u(){if(!n){if(0===a.length)return c.drain&&c.drain(),void 0;var i="number"==typeof t?a.splice(0,t):a.splice(0),s=o(i,function(e){return e.data});c.empty&&c.empty(),n=!0,e(s,function(){n=!1;var e=arguments;r(i,function(t){t.callback&&t.callback.apply(null,e)}),u()})}},length:function(){return a.length},running:function(){return n}};return c};var R=function(e){return function(t){var n=Array.prototype.slice.call(arguments,1);t.apply(null,n.concat([function(t){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(t?console.error&&console.error(t):console[e]&&r(n,function(t){console[e](t)}))}]))}};i.log=R("log"),i.dir=R("dir"),i.memoize=function(e,t){var n={},i={};t=t||function(e){return e};var r=function(){var r=Array.prototype.slice.call(arguments),o=r.pop(),a=t.apply(null,r);a in n?o.apply(null,n[a]):a in i?i[a].push(o):(i[a]=[o],e.apply(null,r.concat([function(){n[a]=arguments;var e=i[a];delete i[a];for(var t=0,r=e.length;r>t;t++)e[t].apply(null,arguments)}])))};return r.memo=n,r.unmemoized=e,r},i.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},i.times=function(e,t,n){for(var r=[],o=0;e>o;o++)r.push(o);return i.map(r,t,n)},i.timesSeries=function(e,t,n){for(var r=[],o=0;e>o;o++)r.push(o);return i.mapSeries(r,t,n)},i.compose=function(){var e=Array.prototype.reverse.call(arguments);return function(){var t=this,n=Array.prototype.slice.call(arguments),r=n.pop();i.reduce(e,n,function(e,n,i){n.apply(t,e.concat([function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);i(e,t)}]))},function(e,n){r.apply(t,[e].concat(n))})}},"undefined"!=typeof define&&define.amd?define([],function(){return i}):"undefined"!=typeof module&&module.exports?module.exports=i:t.async=i})();
(function(){var n=this,t=n._,r={},e=Array.prototype,u=Object.prototype,i=Function.prototype,a=e.push,o=e.slice,c=e.concat,l=u.toString,f=u.hasOwnProperty,s=e.forEach,p=e.map,h=e.reduce,v=e.reduceRight,d=e.filter,g=e.every,m=e.some,y=e.indexOf,b=e.lastIndexOf,x=Array.isArray,_=Object.keys,j=i.bind,w=function(n){return n instanceof w?n:this instanceof w?(this._wrapped=n,void 0):new w(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w):n._=w,w.VERSION="1.4.4";var A=w.each=w.forEach=function(n,t,e){if(null!=n)if(s&&n.forEach===s)n.forEach(t,e);else if(n.length===+n.length){for(var u=0,i=n.length;i>u;u++)if(t.call(e,n[u],u,n)===r)return}else for(var a in n)if(w.has(n,a)&&t.call(e,n[a],a,n)===r)return};w.map=w.collect=function(n,t,r){var e=[];return null==n?e:p&&n.map===p?n.map(t,r):(A(n,function(n,u,i){e[e.length]=t.call(r,n,u,i)}),e)};var O="Reduce of empty array with no initial value";w.reduce=w.foldl=w.inject=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),h&&n.reduce===h)return e&&(t=w.bind(t,e)),u?n.reduce(t,r):n.reduce(t);if(A(n,function(n,i,a){u?r=t.call(e,r,n,i,a):(r=n,u=!0)}),!u)throw new TypeError(O);return r},w.reduceRight=w.foldr=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),v&&n.reduceRight===v)return e&&(t=w.bind(t,e)),u?n.reduceRight(t,r):n.reduceRight(t);var i=n.length;if(i!==+i){var a=w.keys(n);i=a.length}if(A(n,function(o,c,l){c=a?a[--i]:--i,u?r=t.call(e,r,n[c],c,l):(r=n[c],u=!0)}),!u)throw new TypeError(O);return r},w.find=w.detect=function(n,t,r){var e;return E(n,function(n,u,i){return t.call(r,n,u,i)?(e=n,!0):void 0}),e},w.filter=w.select=function(n,t,r){var e=[];return null==n?e:d&&n.filter===d?n.filter(t,r):(A(n,function(n,u,i){t.call(r,n,u,i)&&(e[e.length]=n)}),e)},w.reject=function(n,t,r){return w.filter(n,function(n,e,u){return!t.call(r,n,e,u)},r)},w.every=w.all=function(n,t,e){t||(t=w.identity);var u=!0;return null==n?u:g&&n.every===g?n.every(t,e):(A(n,function(n,i,a){return(u=u&&t.call(e,n,i,a))?void 0:r}),!!u)};var E=w.some=w.any=function(n,t,e){t||(t=w.identity);var u=!1;return null==n?u:m&&n.some===m?n.some(t,e):(A(n,function(n,i,a){return u||(u=t.call(e,n,i,a))?r:void 0}),!!u)};w.contains=w.include=function(n,t){return null==n?!1:y&&n.indexOf===y?n.indexOf(t)!=-1:E(n,function(n){return n===t})},w.invoke=function(n,t){var r=o.call(arguments,2),e=w.isFunction(t);return w.map(n,function(n){return(e?t:n[t]).apply(n,r)})},w.pluck=function(n,t){return w.map(n,function(n){return n[t]})},w.where=function(n,t,r){return w.isEmpty(t)?r?null:[]:w[r?"find":"filter"](n,function(n){for(var r in t)if(t[r]!==n[r])return!1;return!0})},w.findWhere=function(n,t){return w.where(n,t,!0)},w.max=function(n,t,r){if(!t&&w.isArray(n)&&n[0]===+n[0]&&65535>n.length)return Math.max.apply(Math,n);if(!t&&w.isEmpty(n))return-1/0;var e={computed:-1/0,value:-1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;a>=e.computed&&(e={value:n,computed:a})}),e.value},w.min=function(n,t,r){if(!t&&w.isArray(n)&&n[0]===+n[0]&&65535>n.length)return Math.min.apply(Math,n);if(!t&&w.isEmpty(n))return 1/0;var e={computed:1/0,value:1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;e.computed>a&&(e={value:n,computed:a})}),e.value},w.shuffle=function(n){var t,r=0,e=[];return A(n,function(n){t=w.random(r++),e[r-1]=e[t],e[t]=n}),e};var k=function(n){return w.isFunction(n)?n:function(t){return t[n]}};w.sortBy=function(n,t,r){var e=k(t);return w.pluck(w.map(n,function(n,t,u){return{value:n,index:t,criteria:e.call(r,n,t,u)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||r===void 0)return 1;if(e>r||e===void 0)return-1}return n.index<t.index?-1:1}),"value")};var F=function(n,t,r,e){var u={},i=k(t||w.identity);return A(n,function(t,a){var o=i.call(r,t,a,n);e(u,o,t)}),u};w.groupBy=function(n,t,r){return F(n,t,r,function(n,t,r){(w.has(n,t)?n[t]:n[t]=[]).push(r)})},w.countBy=function(n,t,r){return F(n,t,r,function(n,t){w.has(n,t)||(n[t]=0),n[t]++})},w.sortedIndex=function(n,t,r,e){r=null==r?w.identity:k(r);for(var u=r.call(e,t),i=0,a=n.length;a>i;){var o=i+a>>>1;u>r.call(e,n[o])?i=o+1:a=o}return i},w.toArray=function(n){return n?w.isArray(n)?o.call(n):n.length===+n.length?w.map(n,w.identity):w.values(n):[]},w.size=function(n){return null==n?0:n.length===+n.length?n.length:w.keys(n).length},w.first=w.head=w.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:o.call(n,0,t)},w.initial=function(n,t,r){return o.call(n,0,n.length-(null==t||r?1:t))},w.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:o.call(n,Math.max(n.length-t,0))},w.rest=w.tail=w.drop=function(n,t,r){return o.call(n,null==t||r?1:t)},w.compact=function(n){return w.filter(n,w.identity)};var R=function(n,t,r){return A(n,function(n){w.isArray(n)?t?a.apply(r,n):R(n,t,r):r.push(n)}),r};w.flatten=function(n,t){return R(n,t,[])},w.without=function(n){return w.difference(n,o.call(arguments,1))},w.uniq=w.unique=function(n,t,r,e){w.isFunction(t)&&(e=r,r=t,t=!1);var u=r?w.map(n,r,e):n,i=[],a=[];return A(u,function(r,e){(t?e&&a[a.length-1]===r:w.contains(a,r))||(a.push(r),i.push(n[e]))}),i},w.union=function(){return w.uniq(c.apply(e,arguments))},w.intersection=function(n){var t=o.call(arguments,1);return w.filter(w.uniq(n),function(n){return w.every(t,function(t){return w.indexOf(t,n)>=0})})},w.difference=function(n){var t=c.apply(e,o.call(arguments,1));return w.filter(n,function(n){return!w.contains(t,n)})},w.zip=function(){for(var n=o.call(arguments),t=w.max(w.pluck(n,"length")),r=Array(t),e=0;t>e;e++)r[e]=w.pluck(n,""+e);return r},w.object=function(n,t){if(null==n)return{};for(var r={},e=0,u=n.length;u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},w.indexOf=function(n,t,r){if(null==n)return-1;var e=0,u=n.length;if(r){if("number"!=typeof r)return e=w.sortedIndex(n,t),n[e]===t?e:-1;e=0>r?Math.max(0,u+r):r}if(y&&n.indexOf===y)return n.indexOf(t,r);for(;u>e;e++)if(n[e]===t)return e;return-1},w.lastIndexOf=function(n,t,r){if(null==n)return-1;var e=null!=r;if(b&&n.lastIndexOf===b)return e?n.lastIndexOf(t,r):n.lastIndexOf(t);for(var u=e?r:n.length;u--;)if(n[u]===t)return u;return-1},w.range=function(n,t,r){1>=arguments.length&&(t=n||0,n=0),r=arguments[2]||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=0,i=Array(e);e>u;)i[u++]=n,n+=r;return i},w.bind=function(n,t){if(n.bind===j&&j)return j.apply(n,o.call(arguments,1));var r=o.call(arguments,2);return function(){return n.apply(t,r.concat(o.call(arguments)))}},w.partial=function(n){var t=o.call(arguments,1);return function(){return n.apply(this,t.concat(o.call(arguments)))}},w.bindAll=function(n){var t=o.call(arguments,1);return 0===t.length&&(t=w.functions(n)),A(t,function(t){n[t]=w.bind(n[t],n)}),n},w.memoize=function(n,t){var r={};return t||(t=w.identity),function(){var e=t.apply(this,arguments);return w.has(r,e)?r[e]:r[e]=n.apply(this,arguments)}},w.delay=function(n,t){var r=o.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},w.defer=function(n){return w.delay.apply(w,[n,1].concat(o.call(arguments,1)))},w.throttle=function(n,t){var r,e,u,i,a=0,o=function(){a=new Date,u=null,i=n.apply(r,e)};return function(){var c=new Date,l=t-(c-a);return r=this,e=arguments,0>=l?(clearTimeout(u),u=null,a=c,i=n.apply(r,e)):u||(u=setTimeout(o,l)),i}},w.debounce=function(n,t,r){var e,u;return function(){var i=this,a=arguments,o=function(){e=null,r||(u=n.apply(i,a))},c=r&&!e;return clearTimeout(e),e=setTimeout(o,t),c&&(u=n.apply(i,a)),u}},w.once=function(n){var t,r=!1;return function(){return r?t:(r=!0,t=n.apply(this,arguments),n=null,t)}},w.wrap=function(n,t){return function(){var r=[n];return a.apply(r,arguments),t.apply(this,r)}},w.compose=function(){var n=arguments;return function(){for(var t=arguments,r=n.length-1;r>=0;r--)t=[n[r].apply(this,t)];return t[0]}},w.after=function(n,t){return 0>=n?t():function(){return 1>--n?t.apply(this,arguments):void 0}},w.keys=_||function(n){if(n!==Object(n))throw new TypeError("Invalid object");var t=[];for(var r in n)w.has(n,r)&&(t[t.length]=r);return t},w.values=function(n){var t=[];for(var r in n)w.has(n,r)&&t.push(n[r]);return t},w.pairs=function(n){var t=[];for(var r in n)w.has(n,r)&&t.push([r,n[r]]);return t},w.invert=function(n){var t={};for(var r in n)w.has(n,r)&&(t[n[r]]=r);return t},w.functions=w.methods=function(n){var t=[];for(var r in n)w.isFunction(n[r])&&t.push(r);return t.sort()},w.extend=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]=t[r]}),n},w.pick=function(n){var t={},r=c.apply(e,o.call(arguments,1));return A(r,function(r){r in n&&(t[r]=n[r])}),t},w.omit=function(n){var t={},r=c.apply(e,o.call(arguments,1));for(var u in n)w.contains(r,u)||(t[u]=n[u]);return t},w.defaults=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)null==n[r]&&(n[r]=t[r])}),n},w.clone=function(n){return w.isObject(n)?w.isArray(n)?n.slice():w.extend({},n):n},w.tap=function(n,t){return t(n),n};var I=function(n,t,r,e){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof w&&(n=n._wrapped),t instanceof w&&(t=t._wrapped);var u=l.call(n);if(u!=l.call(t))return!1;switch(u){case"[object String]":return n==t+"";case"[object Number]":return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case"[object Date]":case"[object Boolean]":return+n==+t;case"[object RegExp]":return n.source==t.source&&n.global==t.global&&n.multiline==t.multiline&&n.ignoreCase==t.ignoreCase}if("object"!=typeof n||"object"!=typeof t)return!1;for(var i=r.length;i--;)if(r[i]==n)return e[i]==t;r.push(n),e.push(t);var a=0,o=!0;if("[object Array]"==u){if(a=n.length,o=a==t.length)for(;a--&&(o=I(n[a],t[a],r,e)););}else{var c=n.constructor,f=t.constructor;if(c!==f&&!(w.isFunction(c)&&c instanceof c&&w.isFunction(f)&&f instanceof f))return!1;for(var s in n)if(w.has(n,s)&&(a++,!(o=w.has(t,s)&&I(n[s],t[s],r,e))))break;if(o){for(s in t)if(w.has(t,s)&&!a--)break;o=!a}}return r.pop(),e.pop(),o};w.isEqual=function(n,t){return I(n,t,[],[])},w.isEmpty=function(n){if(null==n)return!0;if(w.isArray(n)||w.isString(n))return 0===n.length;for(var t in n)if(w.has(n,t))return!1;return!0},w.isElement=function(n){return!(!n||1!==n.nodeType)},w.isArray=x||function(n){return"[object Array]"==l.call(n)},w.isObject=function(n){return n===Object(n)},A(["Arguments","Function","String","Number","Date","RegExp"],function(n){w["is"+n]=function(t){return l.call(t)=="[object "+n+"]"}}),w.isArguments(arguments)||(w.isArguments=function(n){return!(!n||!w.has(n,"callee"))}),"function"!=typeof/./&&(w.isFunction=function(n){return"function"==typeof n}),w.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},w.isNaN=function(n){return w.isNumber(n)&&n!=+n},w.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"==l.call(n)},w.isNull=function(n){return null===n},w.isUndefined=function(n){return n===void 0},w.has=function(n,t){return f.call(n,t)},w.noConflict=function(){return n._=t,this},w.identity=function(n){return n},w.times=function(n,t,r){for(var e=Array(n),u=0;n>u;u++)e[u]=t.call(r,u);return e},w.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=w.invert(M.escape);var S={escape:RegExp("["+w.keys(M.escape).join("")+"]","g"),unescape:RegExp("("+w.keys(M.unescape).join("|")+")","g")};w.each(["escape","unescape"],function(n){w[n]=function(t){return null==t?"":(""+t).replace(S[n],function(t){return M[n][t]})}}),w.result=function(n,t){if(null==n)return null;var r=n[t];return w.isFunction(r)?r.call(n):r},w.mixin=function(n){A(w.functions(n),function(t){var r=w[t]=n[t];w.prototype[t]=function(){var n=[this._wrapped];return a.apply(n,arguments),D.call(this,r.apply(w,n))}})};var N=0;w.uniqueId=function(n){var t=++N+"";return n?n+t:t},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var T=/(.)^/,q={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;w.template=function(n,t,r){var e;r=w.defaults({},r,w.templateSettings);var u=RegExp([(r.escape||T).source,(r.interpolate||T).source,(r.evaluate||T).source].join("|")+"|$","g"),i=0,a="__p+='";n.replace(u,function(t,r,e,u,o){return a+=n.slice(i,o).replace(B,function(n){return"\\"+q[n]}),r&&(a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),e&&(a+="'+\n((__t=("+e+"))==null?'':__t)+\n'"),u&&(a+="';\n"+u+"\n__p+='"),i=o+t.length,t}),a+="';\n",r.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{e=Function(r.variable||"obj","_",a)}catch(o){throw o.source=a,o}if(t)return e(t,w);var c=function(n){return e.call(this,n,w)};return c.source="function("+(r.variable||"obj")+"){\n"+a+"}",c},w.chain=function(n){return w(n).chain()};var D=function(n){return this._chain?w(n).chain():n};w.mixin(w),A(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=e[n];w.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=n&&"splice"!=n||0!==r.length||delete r[0],D.call(this,r)}}),A(["concat","join","slice"],function(n){var t=e[n];w.prototype[n]=function(){return D.call(this,t.apply(this._wrapped,arguments))}}),w.extend(w.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);
"use strict";if("undefined"==typeof _||!_)throw"ERROR: Underscore is required for fi.fmi.metoclient.metolib.Utils!";var fi=fi||{};if(fi.fmi=fi.fmi||{},fi.fmi.metoclient=fi.fmi.metoclient||{},fi.fmi.metoclient.metolib=fi.fmi.metoclient.metolib||{},fi.fmi.metoclient.metolib.Utils=function(){function a(a){var b=0;if(a)if(_.isFunction(Object.keys))b=Object.keys(a).length;else for(var c in a)a.hasOwnProperty(c)&&++b;return b}return function(){if(!jQuery.browser){var a,b;jQuery.uaMatch=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},a=jQuery.uaMatch(navigator.userAgent),b={},a.browser&&(b[a.browser]=!0,b.version=a.version),b.chrome?b.webkit=!0:b.webkit&&(b.safari=!0),jQuery.browser=b}}(),function(){window.XDomainRequest&&jQuery.ajaxTransport(function(a){if(a.crossDomain&&a.async){a.timeout&&(a.xdrTimeout=a.timeout,delete a.timeout);var b;return{send:function(c,d){function e(a,c,e,f){b.onload=b.onerror=b.ontimeout=jQuery.noop,b=void 0,d(a,c,e,f)}b=new XDomainRequest,b.onload=function(){e(200,"OK",{text:b.responseText},"Content-Type: "+b.contentType)},b.onerror=function(){e(404,"Not Found")},b.onprogress=jQuery.noop,b.ontimeout=function(){e(0,"timeout")},b.timeout=a.xdrTimeout||Number.MAX_VALUE,b.open(a.type,a.url),b.send(a.hasContent&&a.data||null)},abort:function(){b&&(b.onerror=jQuery.noop,b.abort())}}}})}(),function(){Date.prototype.toISOString||(Date.prototype.toJSON||(Date.prototype.toJSON=function(){var a=function(a){return 10>a?"0"+a:a};return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z"}),Date.prototype.toISOString=Date.prototype.toJSON)}(),{objectLength:function(b){return a(b)},encodeUriComponent:function(a){return a?encodeURIComponent(a):a},encodeUri:function(a){return a?encodeURI(a):a},sortStringArray:function(a,b){var c;return a&&_.isArray(a)&&(b?(c=[],_.each(a,function(a){c.push(a)})):c=a,c.sort(function(a,b){var c=0,d=a.toLowerCase(),e=b.toLowerCase();return e>d?c=-1:d>e&&(c=1),c})),c}}}(),"undefined"==typeof jQuery||!jQuery)throw"ERROR: jQuery is required for fi.fmi.metoclient.metolib.WfsRequestParser!";if("undefined"==typeof _||!_)throw"ERROR: Underscore is required for fi.fmi.metoclient.metolib.WfsRequestParser!";var fi=fi||{};if(fi.fmi=fi.fmi||{},fi.fmi.metoclient=fi.fmi.metoclient||{},fi.fmi.metoclient.metolib=fi.fmi.metoclient.metolib||{},"undefined"==typeof fi.fmi.metoclient.metolib.Utils||!fi.fmi.metoclient.metolib.Utils)throw"ERROR: fi.fmi.metoclient.metolib.Utils is required for fi.fmi.metoclient.metolib.WfsRequestParser!";if(fi.fmi.metoclient.metolib.WfsRequestParser=function(){function a(a,c,e){try{var f={info:{begin:void 0,end:void 0},locations:[],positions:{},gmlcovPositions:{srsDimension:void 0,timeIndex:void 0,contents:[]},data:[],parameters:[],properties:{}},g=0,h=function(){++g},i=function(){g>0&&--g,0===g&&(g=-1,cb(e,b(f,c),c))};d(a,f,h,i,c),0===g&&i()}catch(j){console.error("ERROR: Error during synchronous data parsing flow!"),g=-1;var k={};k[lb.KEY_ERROR_TEXT]=j.toString(),c.push(k),cb(e,void 0,c)}}function b(a,b){var d={info:a.info,parameters:a.parameters,properties:a.properties,locations:[]};try{var e=a.gmlcovPositions.srsDimension||0,f=a.gmlcovPositions.contents||[],g=a.parameters.length;if(e>0&&a.data.length===g*(f.length/e)&&a.locations.length===fi.fmi.metoclient.metolib.Utils.objectLength(a.positions)){for(var h=0;h<a.locations.length;++h){var i=a.locations[h],j=i.pointRef,k="ERROR: Location and position data do not match!";if(!j)throw k;var l=a.positions[j];if(!l)throw k;d.locations.push({info:{id:i.id||i.geoid||"",wmo:i.wmo||"",name:i.name||l.name||"",region:i.region||"",country:i.country||"",timezone:i.timezone||"",position:l.position||""}})}for(var m=0;m<f.length;m+=e){for(var n={time:parseInt(f[m+e-1],10)*lb.EPOCH_TO_MS,values:{}},o=0;o<d.parameters.length;++o){var p=d.parameters[o];p&&(n.values[p]=parseFloat(a.data[m/e*g+o]),d.properties[p]||(console.error("ERROR: Server has not provided properties for request parameter!"),d.properties[p]=lb.PROPERTY_OBJECT_EMPTY))}for(var q=0;q<d.locations.length;++q){for(var r=0,s=d.locations[q],t=0;t<s.info.position.length&&s.info.position[t]===f[m+t];++t)++r;if(s.info.position&&r===s.info.position.length){s.timeValuePairs||(s.timeValuePairs=[]),s.timeValuePairs.push(n);break}}}c(d.locations)}else if(0!==a.data.length||0!==f.length)throw"ERROR: Parsed lists do not match!"}catch(u){console.error("ERROR: Could not finalize data!"),d=void 0;var v={};v[lb.KEY_ERROR_TEXT]=u.toString(),b.push(v)}return d}function c(a){if(a&&a.length)for(var b=0;b<a.length-1;++b){for(var c=a[b],d=[],e=b+1;e<a.length;++e){var f=a[e];if(c.info.position.length===f.info.position.length){for(var g=c.info.position.length,h=!0,i=0;g>i;++i)if(c.info.position[i]!==f.info.position[i]){h=!1;break}h&&d.push(f)}}if(d.length)for(var j=c.timeValuePairs,k=j.length/(d.length+1),l=0;l<d.length;++l)d[l].timeValuePairs=j.splice(k,k)}}function d(a,b,c,d,f){a&&(Q(a,f)||jQuery(a).children(lb.XML_WFS_FEATURE_COLLECTION).each(function(){e(this,b,c,d,f)}))}function e(a,b,c,d,e){jQuery(a).children(lb.XML_WFS_MEMBER).each(function(){f(this,b,c,d,e),g(this,b,c,d,e)})}function f(a,b,c,d,e){jQuery(a).children(lb.XML_OMSO_POINT_TIME_SERIES_OBSERVATION).each(function(){h(this,b.info,c,d,e),l(this,b.properties,c,d,e),m(this,b,c,d,e),F(this,b,c,d,e)})}function g(a,b,c,d,e){jQuery(a).children(lb.XML_OMSO_GRID_SERIES_OBSERVATION).each(function(){h(this,b.info,c,d,e),l(this,b.properties,c,d,e),m(this,b,c,d,e),F(this,b,c,d,e)})}function h(a,b,c,d,e){jQuery(a).children(lb.XML_OM_PHENOMENON_TIME).each(function(){i(this,b,c,d,e)})}function i(a,b,c,d,e){jQuery(a).children(lb.XML_GML_TIME_PERIOD).each(function(){j(this,b,c,d,e),k(this,b,c,d,e)})}function j(a,b){jQuery(a).children(lb.XML_GML_BEGIN_POSITION).each(function(){var a=jQuery.trim(jQuery(this).text());a&&(b.begin=new Date(a))})}function k(a,b){jQuery(a).children(lb.XML_GML_END_POSITION).each(function(){var a=jQuery.trim(jQuery(this).text());a&&(b.end=new Date(a))})}function l(a,b,c,d,e){jQuery(a).children(lb.XML_OM_OBSERVED_PROPERTY).each(function(){var a=jQuery.trim(jQuery(this).attr(lb.XML_ATTR_XLINK_HREF));a&&(db(a,e,function(a){Q(a,e)||a&&(T(a,b,c,d,e),V(a,b,c,d,e)),d()}),c())})}function m(a,b,c,d,e){jQuery(a).children(lb.XML_OM_FEATURE_OF_INTEREST).each(function(){n(this,b,c,d,e)})}function n(a,b,c,d,e){jQuery(a).children(lb.XML_SAMS_SF_SPATIAL_SAMPLING_FEATURE).each(function(){o(this,b.locations,c,d,e),y(this,b.positions,c,d,e)})}function o(a,b,c,d,e){jQuery(a).children(lb.XML_SAM_SAMPLED_FEATURE).each(function(){p(this,b,c,d,e)})}function p(a,b,c,d,e){jQuery(a).children(lb.XML_TARGET_LOCATION_COLLECTION).each(function(){q(this,b,c,d,e)})}function q(a,b,c,d,e){jQuery(a).children(lb.XML_TARGET_MEMBER).each(function(){r(this,b,c,d,e)})}function r(a,b,c,d,e){jQuery(a).children(lb.XML_TARGET_LOCATION).each(function(){var a={};s(this,a,c,d,e),t(this,a,c,d,e),u(this,a,c,d,e),v(this,a,c,d,e),w(this,a,c,d,e),x(this,a,c,d,e),b.push(a)})}function s(a,b){jQuery(a).children(lb.XML_GML_IDENTIFIER).each(function(){b.id=jQuery.trim(jQuery(this).text())})}function t(a,b){jQuery(a).children(lb.XML_GML_NAME).each(function(){var a=jQuery.trim(jQuery(this).attr(lb.XML_ATTR_CODE_SPACE));lb.XML_ATTR_CODE_SPACE_NAME===a?b.name=jQuery.trim(jQuery(this).text()):lb.XML_ATTR_CODE_SPACE_WMO===a?b.wmo=jQuery.trim(jQuery(this).text()):lb.XML_ATTR_CODE_SPACE_GEOID===a&&(b.geoid=jQuery.trim(jQuery(this).text()))})}function u(a,b){jQuery(a).children(lb.XML_TARGET_REGION).each(function(){b.region=jQuery.trim(jQuery(this).text())})}function v(a,b){jQuery(a).children(lb.XML_TARGET_COUNTRY).each(function(){b.country=jQuery.trim(jQuery(this).text())})}function w(a,b){jQuery(a).children(lb.XML_TARGET_TIMEZONE).each(function(){b.timezone=jQuery.trim(jQuery(this).text())})}function x(a,b){jQuery(a).children(lb.XML_TARGET_REPRESENTATIVE_POINT).each(function(){b.pointRef=jQuery.trim(jQuery(this).attr(lb.XML_ATTR_XLINK_HREF)),b.pointRef&&b.pointRef.charAt(0)===lb.XML_REF_PREFIX&&(b.pointRef=b.pointRef.slice(1))})}function y(a,b,c,d,e){jQuery(a).children(lb.XML_SAMS_SHAPE).each(function(){A(this,b,c,d,e)})}function z(a,b,c,d,e){jQuery(a).children(lb.XML_GML_POINT).each(function(){var a=this,f=jQuery.trim(jQuery(a).attr(lb.XML_ATTR_GML_ID));if(f){b[f]||(b[f]={name:"",position:[]});var g=b[f];D(this,g,c,d,e),E(this,g.position,c,d,e)}})}function A(a,b,c,d,e){jQuery(a).children(lb.XML_GML_MULTI_POINT).each(function(){B(this,b,c,d,e),C(this,b,c,d,e)})}function B(a,b,c,d,e){jQuery(a).children(lb.XML_GML_POINT_MEMBER).each(function(){z(this,b,c,d,e)})}function C(a,b,c,d,e){jQuery(a).children(lb.XML_GML_POINT_MEMBERS).each(function(){z(this,b,c,d,e)})}function D(a,b){jQuery(a).children(lb.XML_GML_NAME).each(function(){b.name=jQuery.trim(jQuery(this).text())})}function E(a,b){jQuery(a).children(lb.XML_GML_POS).each(function(){var a=jQuery.trim(jQuery(this).text());a&&b.push.apply(b,a.split(lb.REGEX_WHITE_SPACE))})}function F(a,b,c,d,e){jQuery(a).children(lb.XML_OM_RESULT).each(function(){G(this,b,c,d,e)})}function G(a,b,c,d,e){jQuery(a).children(lb.XML_GMLCOV_MULTI_POINT_COVERAGE).each(function(){K(this,b,c,d,e),N(this,b,c,d,e),H(this,b,c,d,e)})}function H(a,b,c,d,e){jQuery(a).children(lb.XML_GMLCOV_RANGE_TYPE).each(function(){I(this,b,c,d,e)})}function I(a,b,c,d,e){jQuery(a).children(lb.XML_SWE_DATA_RECORD).each(function(){J(this,b.parameters,c,d,e)})}function J(a,b){jQuery(a).children(lb.XML_SWE_FIELD).each(function(){var a=jQuery.trim(jQuery(this).attr(lb.XML_ATTR_NAME));a&&b.push(a)})}function K(a,b,c,d,e){jQuery(a).children(lb.XML_GML_DOMAIN_SET).each(function(){L(this,b,c,d,e)})}function L(a,b,c,d,e){jQuery(a).children(lb.XML_GMLCOV_SIMPLE_MULTI_POINT).each(function(){var a=jQuery.trim(jQuery(this).attr(lb.XML_ATTR_SRS_DIMENSION));a&&(a=parseInt(a,10),a>0&&(b.gmlcovPositions.srsDimension=a,b.gmlcovPositions.timeIndex=a-1)),M(this,b.gmlcovPositions.contents,c,d,e)})}function M(a,b){jQuery(a).children(lb.XML_GMLCOV_POSITIONS).each(function(){var a=jQuery.trim(jQuery(this).text());a&&b.push.apply(b,a.split(lb.REGEX_WHITE_SPACE))})}function N(a,b,c,d,e){jQuery(a).children(lb.XML_GML_RANGE_SET).each(function(){O(this,b,c,d,e)})}function O(a,b,c,d,e){jQuery(a).children(lb.XML_GML_DATA_BLOCK).each(function(){P(this,b.data,c,d,e)})}function P(a,b){jQuery(a).children(lb.XML_GML_DOUBLE_OR_NIL_REASON_TUPLE_LIST).each(function(){var a=jQuery.trim(jQuery(this).text());a&&b.push.apply(b,a.split(lb.REGEX_WHITE_SPACE))})}function Q(a,b){var c=!1;try{a&&jQuery(a).children(lb.XML_EXCEPTION_REPORT).each(function(){c=!0;var a={};b.push(a),R(this,a)})}catch(d){console.error("ERROR: Error while parsing exception data!");var e={};e[lb.KEY_ERROR_TEXT]=d.toString(),b.push(e)}return c}function R(a,b){jQuery(a).children(lb.XML_EXCEPTION).each(function(){b[lb.KEY_ERROR_CODE]=jQuery.trim(jQuery(this).attr(lb.XML_ATTR_EXCEPTION_CODE)),S(this,b)})}function S(a,b){jQuery(a).children(lb.XML_EXCEPTION_TEXT).each(function(){b[lb.KEY_ERROR_TEXT]=jQuery.trim(jQuery(this).text())})}function T(a,b,c,d,e){jQuery(a).children(lb.XML_COMPOSITE_OBSERVABLE_PROPERTY).each(function(){U(this,b,c,d,e)})}function U(a,b,c,d,e){jQuery(a).children(lb.XML_COMPONENT).each(function(){V(this,b,c,d,e)})}function V(a,b,c,d,e){jQuery(a).children(lb.XML_OBSERVABLE_PROPERTY).each(function(){var a=jQuery.trim(jQuery(this).attr(lb.XML_ATTR_GML_ID));if(a){var f=_.clone(lb.PROPERTY_OBJECT_EMPTY);W(this,f,c,d,e),X(this,f,c,d,e),Y(this,f,c,d,e),Z(this,f,c,d,e),b[a]=f}})}function W(a,b){jQuery(a).children(lb.XML_LABEL).each(function(){b.label=jQuery.trim(jQuery(this).text())})}function X(a,b){jQuery(a).children(lb.XML_BASE_PHENOMENON).each(function(){b.phenomenon=jQuery.trim(jQuery(this).text())})}function Y(a,b){jQuery(a).children(lb.XML_UOM).each(function(){b.unit=jQuery.trim(jQuery(this).attr(lb.XML_ATTR_UOM))})}function Z(a,b,c,d,e){jQuery(a).children(lb.XML_STATISTICAL_MEASURE).each(function(){$(this,b,c,d,e)})}function $(a,b,c,d,e){jQuery(a).children(lb.XML_STATISTICAL_MEASURE_INNER).each(function(){ab(this,b,c,d,e),bb(this,b,c,d,e)})}function ab(a,b){jQuery(a).children(lb.XML_STATISTICAL_FUNCTION).each(function(){b.statisticalFunction=jQuery.trim(jQuery(this).text())})}function bb(a,b){jQuery(a).children(lb.XML_AGGREGATION_TIME_PERIOD).each(function(){b.statisticalPeriod=jQuery.trim(jQuery(this).text())})}function cb(a,b,c){try{a&&a(b,c)}catch(d){console.error("ERROR: Callback function error!")}}function db(a,b,c){setTimeout(function(){jQuery.ajax({type:lb.HTTP_METHOD,url:a,dataType:lb.DATA_TYPE,success:function(a){cb(c,a,b)},error:function(a,d,e){var f={};f[lb.KEY_ERROR_CODE]=a.status,f[lb.KEY_ERROR_TEXT]=e||d,b.push(f),cb(c,void 0,b)}})},0)}function eb(b,c){var d=[];db(b,d,function(b,d){a(b,d,c)})}function fb(a,b,c){if(a&&a.parameters&&b&&c)for(var d=0;d<a.parameters.length;++d){var e=a.parameters[d];if(e){for(var f={property:a.properties[e],timeValuePairs:[]},g=0;g<b.length;++g){var h=b[g];f.timeValuePairs.push({time:h.time,value:h.values[e]})}c[e]=f}}}function gb(a,b,c){var d;try{if(b&&b.parameters&&b.properties&&(d={info:b.info,properties:b.properties,locations:[]},b.locations&&b.locations.length>0))for(var e=b.locations,f=0;f<e.length;++f){var g=e[f],h={info:g.info,data:{}};fb(b,g.timeValuePairs,h.data),d.locations.push(h)}}catch(i){var j="ERROR: Could not finalize data!";console.error(j),d=void 0;var k={};k[lb.KEY_ERROR_TEXT]=i.toString(),c.push(k)}a(d,c)}function hb(a,b,c,d,e,f,g,h,i,j,k,l){if(d instanceof Date||isNaN(d)||(d=new Date(d)),e instanceof Date||isNaN(e)||(e=new Date(e)),c&&_.isArray(c)&&(c=c.join()),(void 0===f||null===f)&&g&&g>0&&d instanceof Date&&e instanceof Date&&(f=Math.round((e.getTime()-d.getTime())/g)),!(a&&_.isString(a)&&b&&_.isString(b)&&c&&_.isString(c)&&d instanceof Date&&e instanceof Date&&d.getTime()<=e.getTime())||f&&!_.isNumber(f)||!i&&!j||i&&!_.isString(i)&&!_.isArray(i)||j&&!_.isString(j)||k&&!_.isString(k)){var m="ERROR: Wrong or missing information for the request!";throw console.error(m),m}h||(d.setTime(ib(f,d).getTime()),e.setTime(jb(f,e,d).getTime()));var n=/\.\d+/;d=fi.fmi.metoclient.metolib.Utils.encodeUriComponent(d.toISOString()).split(n).join(""),e=fi.fmi.metoclient.metolib.Utils.encodeUriComponent(e.toISOString()).split(n).join("");var o="",p=Math.floor(f/lb.MIN_TO_MS);p&&p>0&&(o=lb.REQUEST_TIMESTEP+p),c=fi.fmi.metoclient.metolib.Utils.encodeUriComponent(c);var q="";if(i){_.isString(i)&&(i=[i]);for(var r=0;r<i.length;++r){var s=i[r];s&&(s=fi.fmi.metoclient.metolib.Utils.encodeUriComponent(s),q+=lb.REQUEST_PLACE+s)}}var t="";j&&(t=lb.REQUEST_BBOX+fi.fmi.metoclient.metolib.Utils.encodeUriComponent(j));var u="";k&&(u=lb.REQUEST_CRS+fi.fmi.metoclient.metolib.Utils.encodeUriComponent(k));var v=lb.REQUEST_STORED_QUERY_ID+fi.fmi.metoclient.metolib.Utils.encodeUriComponent(b),w=-1===a.indexOf(lb.URL_QUERY_PREFIX_BEGIN)?lb.URL_QUERY_PREFIX_BEGIN:lb.URL_QUERY_PREFIX_AND;a.length>0&&(a.indexOf(lb.URL_QUERY_PREFIX_BEGIN)===a.length-1||a.indexOf(lb.URL_QUERY_PREFIX_AND)===a.length-1)&&(w="");var x=a+w+lb.REQUEST_GET_FEATURE+v+lb.REQUEST_PARAMETERS+c+lb.REQUEST_BEGIN+d+lb.REQUEST_END+e+o+q+t+u;eb(x,l)}function ib(a,b){var c;if(void 0!==b&&null!==b){c=b instanceof Date?new Date(b.getTime()):new Date(b),c.setMilliseconds(0),c.setSeconds(0);var d=a?Math.floor(a/lb.MIN_TO_MS):void 0;if(d){var e=c.getMinutes();e-=e%d,c.setMinutes(e)}}return c}function jb(a,b,c){var d;if(void 0!==c&&null!==c&&void 0!==b&&null!==b){d=b instanceof Date?new Date(b.getTime()):new Date(b);var e=ib(a,c);if(a){var f=(d.getTime()-e.getTime())%a;f>0&&d.setTime(d.getTime()+(a-f))}}return d}function kb(a){if(!a||!a.callback){var b="ERROR: Options object and callback function in it are mandatory!";throw console.error(b),b}try{hb(a.url,a.storedQueryId,a.requestParameter,a.begin,a.end,a.timestep,a.numOfTimesteps,a.denyTimeAdjusting,a.sites,a.bbox,a.crs,function(b,c){gb(a.callback,b,c)})}catch(c){setTimeout(function(){console.error("ERROR: Get data error!");var b={};b[lb.KEY_ERROR_TEXT]=c.toString(),cb(a.callback,void 0,[b])},0)}}var lb={REGEX_WHITE_SPACE:/\s+/,EPOCH_TO_MS:1e3,MIN_TO_MS:6e4,HTTP_METHOD:"GET",DATA_TYPE:"xml",URL_QUERY_PREFIX_BEGIN:"?",URL_QUERY_PREFIX_AND:"&",REQUEST_GET_FEATURE:"request=getFeature",REQUEST_STORED_QUERY_ID:"&storedquery_id=",REQUEST_PARAMETERS:"&parameters=",REQUEST_BEGIN:"&starttime=",REQUEST_END:"&endtime=",REQUEST_TIMESTEP:"&timestep=",REQUEST_PLACE:"&place=",REQUEST_BBOX:"&bbox=",REQUEST_CRS:"&crs=",XML_WFS_FEATURE_COLLECTION:"wfs\\:FeatureCollection, FeatureCollection",XML_WFS_MEMBER:"wfs\\:member, member",XML_OMSO_POINT_TIME_SERIES_OBSERVATION:"omso\\:PointTimeSeriesObservation, PointTimeSeriesObservation",XML_OMSO_GRID_SERIES_OBSERVATION:"omso\\:GridSeriesObservation, GridSeriesObservation",XML_OM_PHENOMENON_TIME:"om\\:phenomenonTime, phenomenonTime",XML_GML_TIME_PERIOD:"gml\\:TimePeriod, TimePeriod",XML_GML_BEGIN_POSITION:"gml\\:beginPosition, beginPosition",XML_GML_END_POSITION:"gml\\:endPosition, endPosition",XML_OM_OBSERVED_PROPERTY:"om\\:observedProperty, observedProperty",XML_OM_FEATURE_OF_INTEREST:"om\\:featureOfInterest, featureOfInterest",XML_SAMS_SF_SPATIAL_SAMPLING_FEATURE:"sams\\:SF_SpatialSamplingFeature, SF_SpatialSamplingFeature",XML_SAM_SAMPLED_FEATURE:"sam\\:sampledFeature, sampledFeature",XML_TARGET_LOCATION_COLLECTION:"target\\:LocationCollection, LocationCollection",XML_TARGET_MEMBER:"target\\:member, member",XML_TARGET_LOCATION:"target\\:Location, Location",XML_GML_IDENTIFIER:"gml\\:identifier, identifier",XML_TARGET_REGION:"target\\:region, region",XML_TARGET_COUNTRY:"target\\:country, country",XML_TARGET_TIMEZONE:"target\\:timezone, timezone",XML_TARGET_REPRESENTATIVE_POINT:"target\\:representativePoint, representativePoint",XML_SAMS_SHAPE:"sams\\:shape, shape",XML_GML_MULTI_POINT:"gml\\:MultiPoint, MultiPoint",XML_GML_POINT_MEMBER:"gml\\:pointMember, pointMember",XML_GML_POINT_MEMBERS:"gml\\:pointMembers, pointMembers",XML_GML_POINT:"gml\\:Point, Point",XML_GML_NAME:"gml\\:name, name",XML_GML_POS:"gml\\:pos, pos",XML_OM_RESULT:"om\\:result, result",XML_GMLCOV_MULTI_POINT_COVERAGE:"gmlcov\\:MultiPointCoverage, MultiPointCoverage",XML_GML_DOMAIN_SET:"gml\\:domainSet, domainSet",XML_GMLCOV_SIMPLE_MULTI_POINT:"gmlcov\\:SimpleMultiPoint, SimpleMultiPoint",XML_GMLCOV_POSITIONS:"gmlcov\\:positions, positions",XML_GML_RANGE_SET:"gml\\:rangeSet, rangeSet",XML_GML_DATA_BLOCK:"gml\\:DataBlock, DataBlock",XML_GML_DOUBLE_OR_NIL_REASON_TUPLE_LIST:"gml\\:doubleOrNilReasonTupleList, doubleOrNilReasonTupleList",XML_GMLCOV_RANGE_TYPE:"gmlcov\\:rangeType, rangeType",XML_SWE_DATA_RECORD:"swe\\:DataRecord, DataRecord",XML_SWE_FIELD:"swe\\:field, field",XML_COMPOSITE_OBSERVABLE_PROPERTY:"CompositeObservableProperty",XML_COMPONENT:"component",XML_OBSERVABLE_PROPERTY:"ObservableProperty",XML_LABEL:"label",XML_BASE_PHENOMENON:"basePhenomenon",XML_UOM:"uom",XML_STATISTICAL_MEASURE:"statisticalMeasure",XML_STATISTICAL_MEASURE_INNER:"StatisticalMeasure",XML_STATISTICAL_FUNCTION:"statisticalFunction",XML_AGGREGATION_TIME_PERIOD:"aggregationTimePeriod",XML_ATTR_NAME:"name",XML_ATTR_SRS_DIMENSION:"srsDimension",XML_ATTR_XLINK_HREF:"xlink:href",XML_ATTR_GML_ID:"gml:id",XML_ATTR_CODE_SPACE:"codeSpace",XML_ATTR_CODE_SPACE_NAME:"http://xml.fmi.fi/namespace/locationcode/name",XML_ATTR_CODE_SPACE_WMO:"http://xml.fmi.fi/namespace/locationcode/wmo",XML_ATTR_CODE_SPACE_GEOID:"http://xml.fmi.fi/namespace/locationcode/geoid",XML_ATTR_UOM:"uom",XML_REF_PREFIX:"#",XML_EXCEPTION_REPORT:"ExceptionReport",XML_EXCEPTION:"Exception",XML_ATTR_EXCEPTION_CODE:"exceptionCode",XML_EXCEPTION_TEXT:"ExceptionText",KEY_ERROR_CODE:"errorCode",KEY_ERROR_TEXT:"errorText",PROPERTY_OBJECT_EMPTY:{label:"",unit:"",phenomenon:"",statisticalFunction:"",statisticalPeriod:""}};return{getData:kb,adjustBeginTime:ib,adjustEndTime:jb}}(),"undefined"==typeof _||!_)throw"ERROR: Underscore is required for fi.fmi.metoclient.metolib.SplitterCache!";if("undefined"==typeof async||!async)throw"ERROR: Async is required for fi.fmi.metoclient.metolib.SplitterCache!";var fi=fi||{};if(fi.fmi=fi.fmi||{},fi.fmi.metoclient=fi.fmi.metoclient||{},fi.fmi.metoclient.metolib=fi.fmi.metoclient.metolib||{},fi.fmi.metoclient.metolib.SplitterCache=function(){var a=function(a){var b,c=0;if(!_.isObject(a))throw"taskdef must be an object";if(!_.isString(a.service))throw"taskDef must contain a 'service' property of string type";if(!_.isArray(a.location)){if(!_.isString(a.location))throw"taskDef must contain a 'location' property of either an array or a string type";b=a.location,a.location=[],a.location.push(b)}if(!_.isArray(a.parameter)){if(!_.isString(a.parameter))throw"taskDef must contain a 'parameter' property of either an array or a string type";b=a.parameter,a.parameter=[],a.parameter.push(b)}if(!_.isNumber(a.resolution))throw"taskDef must contain a 'resolution' property of numeric type";if(!(a.resolution>.5))throw"taskDef.resolution must be a positive integer";if(a.resolution=Math.round(a.resolution),!_.isNumber(a.start))throw"taskDef must contain a 'start' property of numeric type";if(_.isNumber(a.pointCount)){if(!(a.pointCount>0))throw"taskDef.pointCount must be greater than zero";a.end=a.start+(a.pointCount-1)*a.resolution}else{if(!_.isNumber(a.end))throw"taskDef must contain either 'end' or 'pointCount' property of numeric type";if(a.end<a.start)throw"'end' must be greater than or equal to 'start'";c=(a.end-a.start)%a.resolution,0!==c&&(a.end=a.end+(a.resolution-c)),a.pointCount=(a.end-a.start)/a.resolution+1}},b=function(a,b){var c=0;if(_.isArray(a)&&_.isArray(b)){if(a.length===b.length){for(c=0;c<a.length;c++)if(-1===_.indexOf(b,a[c]))return!1;return!0}return!1}return void 0===a||null===a||void 0===b||null===b?!1:a===b},c=function(){var b=0,c=function(c){function d(){f=null,g=null,h=null,i=null,j=0,k=!1,l=!1,m=!1,n=!1,o=!1,p=[]}var e=null,f=null,g=null,h=null,i=null,j=0,k=!1,l=!1,m=!1,n=!1,o=!1,p=[],q=c,r=this;this.getId=function(){return e},this.getTaskDef=function(){return i},this.getStart=function(){return null!==i?i.start:void 0},this.getEnd=function(){return null!==i?i.end:void 0},this.getPointCount=function(){return null!==i?i.pointCount:void 0},this.getResolution=function(){return null!==i?i.resolution:void 0},this.getService=function(){return null!==i?i.service:void 0},this.getLocation=function(){return null!==i?i.location:void 0},this.getParameter=function(){return null!==i?i.parameter:void 0},this.getDataSize=function(){return null!==i?i.pointCount*i.parameter.length*i.location.length:0},this.pin=function(){return n?!1:(m||(m=!0,q&&q("blockPinned",r)),!0)},this.unpin=function(){m&&(m=!1,q&&q("blockUnpinned",r))},this.isPinned=function(){return m},this.isWaitingRecycling=function(){return n},this.increaseNotUsed=function(){j++,q&&q("blockAged",r)},this.getNotUsedSince=function(){return j},this.markForRecycling=function(){n=!0,q&&q("blockEvicted",r)},this.recycle=function(){d(),q&&q("blockRecycled",r)},this.prepare=function(b,c){if(!_.isFunction(c))throw"fetcher must be a function";a(b),d(),i=b,g=c,o=!0,q&&q("blockPrepared",r)},this.getDataAsync=function(a){var b=this;if(!o)throw"Cannot getData in unprepared state, call prepare first";j=0,l?_.isFunction(a)?(_.defer(function(c,d){q&&q("blockCacheFetchFinished",r),a(c,d),b.unpin()},f,h),q&&q("blockCacheFetchStarted",r)):b.unpin():(void 0!==a&&_.isFunction(a)&&p.push(a),k||(k=!0,g(i,function(a,c){a&&(f=a),h=c,l=!0,q&&q("blockProviderFetchFinished",r),0===p.length?(k=!1,b.unpin()):async.each(p,function(a,c){try{a.call(b,f,h)}catch(d){}c()},function(){p=[],k=!1,b.unpin()})}),q&&q("blockProviderFetchStarted",r)))},e="id#"+b++,q&&q("blockCreated",r)};return c}(),d=0,e=0,f=function(f){function g(a,b){void 0!==F[a]&&_.each(F[a],function(a){try{a.call(E,b)}catch(c){}})}function h(a,b){var c=null;if(void 0===F[a])throw"Unknown event '"+a+"', use one of "+_.reduce(_.keys(F),function(a,b,c){return c>0&&(a+=", "),a+=b});if(!_.isFunction(b))throw"Event listener callback is not a function";return c="id"+d++,F[a][c]=b,c}function i(a,b){if(void 0===F[a])throw"Unknown event '"+a+"', use one of "+_.reduce(_.keys(F),function(a,b,c){c>0&&(a+=", "),a+=b});void 0!==F[a][b]&&delete F[a][b]}function j(a){async.each(a,function(a,b){a.markForRecycling(),b()},function(a){a&&console.error(a)})}function k(){var a;return a=t.length>0?t.pop():new c(g)}function l(a,b,c,d){var e=!1;return a===c&&b===d?e=!0:d>=a&&b>c&&(e=!0),e}function m(a,b,c,d,e,f){var g=null;return(0===a||b<c-f.resolution)&&c>d&&(g=c>=e?null===b?o(f,d,e):o(f,Math.max(b,d),e):null===b?o(f,d,c):o(f,Math.max(b,d),c)),g}function n(a){var c=[],d=a.start,e=a.end,f=Math.ceil(w*a.pointCount),h=Math.ceil(x*a.pointCount),i=d-f*a.resolution,k=e+h*a.resolution,n=[],p=[];return B=0,u.length>0&&_.each(u,function(d,e){var f=!1,g=null,h=null,j=0===e?null:u[e-1].getEnd(),q=d.getStart(),r=d.getEnd();if(d.isWaitingRecycling())return d.isPinned()?async.whilst(function(){return d.isPinned()},function(a){setTimeout(a,500)},function(){d.recycle(),t.push(d)}):(d.recycle(),t.push(d)),void 0;p.push(d),a.service===d.getService()&&b(a.location,d.getLocation())&&b(a.parameter,d.getParameter())?(g=m(e,j,q,i,k,a),null!==g&&g.length>0&&(Array.prototype.push.apply(p,g),async.reduce(g,D,function(a,b,c){c(null,a+b.getDataSize())},function(a,b){D=b}),Array.prototype.push.apply(c,g)),f=l(q,r,i,k),f?d.pin()?(c.push(d),C+=d.getDataSize()):console&&console.error("Strange, unable to pin block!"):d.increaseNotUsed(),e===u.length-1&&r+a.resolution<k&&(h=o(a,r+a.resolution,k),Array.prototype.push.apply(p,h),async.reduce(h,D,function(a,b,c){c(null,a+b.getDataSize())},function(a,b){D=b}),Array.prototype.push.apply(c,h))):d.increaseNotUsed();var s=_.sortedIndex(n,d,function(a){return a.getNotUsedSince()});n.splice(s,0,d),B+=d.getDataSize()}),0===c.length&&(c=o(a,i,k),Array.prototype.push.apply(p,c),async.reduce(c,D,function(a,b,c){c(null,a+b.getDataSize())},function(a,b){D=b})),u=[],u=p,p=[],async.whilst(function(){return 1.01*B>z},function(){var a=1.01*B-z;g("evictStarted",{inCache:B,toEvict:a});for(var b=[],c=null,d=0;a>d&&n.length>0;)c=n.pop(),void 0!==c&&(d+=c.getDataSize(),b.push(c));b.length>0&&(j(b),B-=d,g("evictFinished",{inCache:B,evicted:d}))},function(){}),c}function o(a,b,c){var d,e=[],f=Math.round((c-b)/a.resolution)+1,g=Math.ceil(f/y),h=0,i=null;for(h=0;g>h;h++)i=k(),d=_.clone(a),d.start=b+h*a.resolution*y,d.pointCount=Math.min(y,f-h*y),d.end=d.start+(d.pointCount-1)*a.resolution,i.prepare(d,r(a.service)),i.pin()?e.push(i):console.error("Strange, unable to pin block!");return e}function p(a,b,c,d,e,f,g,h){var i=_.isObject(b);async.each(c,function(c,h){void 0===a.data[c]&&(a.data[c]={}),async.each(d,function(d,h){var j=!1;void 0===a.data[c][d]&&(a.data[c][d]=[]),i&&(_.isObject(b[c])&&_.isArray(b[c][d])?b[c][d].length<f+g&&(j=!0,console&&console.error("The service returned "+b[c][d].length+" values for location "+c+" and parameter "+d+" when "+(f+g)+" were requested. Filling the whole segment with NaN")):j=!0);for(var k=0;g>k;k++)a.data[c][d][e+k]=i?j?0/0:b[c][d][f+k]:b;h()},function(){h()})},function(){h()})}function q(a,b,c){var d={},e=null,f=!1;if(!_.isFunction(b))throw"finishCallback must be a function";if(_.isFunction(c)&&(f=!0),null===r(a.service))throw"No data fetcher set for service '"+a.service+"', unable to provide data";void 0!==v[a.service]&&(v[a.service].resolution!==a.resolution||0!==Math.abs(v[a.service].start-a.start)%a.resolution)&&s(a.service),v[a.service]={start:a.start,resolution:a.resolution};var h=n(a);d.steps=_.range(a.start,a.end+a.resolution,a.resolution),d.data={},async.each(h,function(b,g){var h=b.getTaskDef(),i=0/0,j=0/0,k=0/0,m=0/0,n=0/0,o=0/0;return l(h.start,h.end,a.start,a.end)?(h.start<a.start?(i=a.start,n=Math.round((a.start-h.start)/a.resolution)):(i=h.start,n=0),k=_.indexOf(d.steps,i,!0),h.end>a.end?(j=a.end,m=d.steps.length-1):(j=h.end,m=_.indexOf(d.steps,h.end,!0)),o=m-k+1,b.getDataAsync(function(a,b){var l=b;a&&(null===e&&(e=[]),e.push({start:h.start,end:h.end,error:a}),b||(l=0/0)),p(d,l,h.location,h.parameter,k,n,o,function(){f&&c(a,i,j),g()})}),void 0):(b.getDataAsync(),g(),void 0)},function(){b(e,d),g("fetchFinished",a)})}function r(a){return void 0!==A[a]?(A[a].nextIndex=(A[a].nextIndex+1)%A[a].providers.length,A[a].providers[A[a].nextIndex].cb):null}function s(a){_.each(u,function(b){(void 0===a||b.getService()===a)&&b.markForRecycling()}),g("cacheCleared",a)}var t=[],u=[],v=[],w=.5,x=1,y=500,z=5e4,A={},B=0,C=0,D=0,E=this,F={blockCreated:{},blockPrepared:{},blockProviderFetchStarted:{},blockProviderFetchFinished:{},blockCacheFetchStarted:{},blockCacheFetchFinished:{},blockPinned:{},blockUnpinned:{},blockEvicted:{},blockRecycled:{},blockAged:{},evictStarted:{},evictFinished:{},fetchStarted:{},fetchFinished:{},cacheCleared:{},dataProviderAdded:{},dataProviderRemoved:{}};this.addDataProvider=function(a,b){var c={};if(!_.isFunction(b))throw"Fetcher must be a function";return void 0===A[a]&&(A[a]={nextIndex:0,providers:[]}),c.id="id#"+e++,c.cb=b,A[a].providers.push(c),g("dataProviderAdded",{service:a,providerId:c.id}),c.id},this.removeDataProvider=function(a,b){var c=0,d=!1;void 0!==A[a]&&(c=A[a].providers.length,A[a].providers=_.reject(A[a].providers,function(a){return a.id===b}),0===A[a].providers.length?(delete A.service,d=!0):c!==A[a].providers.length&&(d=!0),d&&g("dataProviderRemoved",{service:a,providerId:b}))},this.clearCache=function(){s(),v=[],C=0,D=0},this.fetch=function(b,c,d){a(b),g("fetchStarted",b),q(b,c,d)},this.getCachedItemCount=function(){return B},this.getFillingDegree=function(){return B/z},this.getHitRatio=function(){return C/(C+D)},this.addListener=function(a,b){return h(a,b)},this.removeListener=function(a,b){return i(a,b)},void 0!==f.sideFetchBeforeFactor&&_.isNumber(f.sideFetchBeforeFactor)&&f.sideFetchBeforeFactor>=0&&(w=f.sideFetchBeforeFactor),void 0!==f.sideFetchAfterFactor&&_.isNumber(f.sideFetchAfterFactor)&&f.sideFetchAfterFactor>=0&&(x=f.sideFetchAfterFactor),void 0!==f.maxBlockDataPoints&&_.isNumber(f.maxBlockDataPoints)&&f.maxBlockDataPoints>0&&(y=f.maxBlockDataPoints),void 0!==f.maxCacheDataSize&&_.isNumber(f.maxCacheDataSize)&&f.maxCacheDataSize>0&&(z=f.maxCacheDataSize)};return f}(),"undefined"==typeof jQuery||!jQuery)throw"ERROR: jQuery is required for fi.fmi.metoclient.metolib.WfsConnection!";if("undefined"==typeof _||!_)throw"ERROR: Underscore is required for fi.fmi.metoclient.metolib.WfsConnection!";if("undefined"==typeof async||!async)throw"ERROR: Async is required for fi.fmi.metoclient.metolib.WfsConnection!";var fi=fi||{};if(fi.fmi=fi.fmi||{},fi.fmi.metoclient=fi.fmi.metoclient||{},fi.fmi.metoclient.metolib=fi.fmi.metoclient.metolib||{},!fi.fmi.metoclient.metolib.Utils)throw"ERROR: fi.fmi.metoclient.metolib.Utils is required for fi.fmi.metoclient.metolib.WfsConnection!";if(!fi.fmi.metoclient.metolib.SplitterCache)throw"ERROR: fi.fmi.metoclient.metolib.SplitterCache is required for fi.fmi.metoclient.metolib.WfsConnection!";if(!fi.fmi.metoclient.metolib.WfsRequestParser)throw"ERROR: fi.fmi.metoclient.metolib.WfsRequestParser is required for fi.fmi.metoclient.metolib.WfsConnection!";fi.fmi.metoclient.metolib.WfsConnection=function(){function a(a){return jQuery.trim(a).replace(/,\s+/,k)}function b(b){var c=[];if(_.isString(b))c.push(a(b));else if(_.isArray(b))for(var d=0;d<b.length;++d){var e=b[d];e&&c.push(a(e))}return c}function c(a,b,c){var d=c;if(a&&a.location&&b&&c){var e=c+l,f=b.indexOf(e);0===f&&(b=jQuery.trim(b.slice(e.length)));for(var g=b+k+c,h=0;h<a.location.length;++h){var i=a.location[h];if(-1!==i.indexOf(k)&&i===g){d=i;break}}}return d}function d(a,b){if(_.isArray(a)&&b&&b>0)for(var c=1;c<a.length;++c){var d=a[c-1],e=a[c];if(_.isObject(e)){var f=_.isObject(d)?d.time:void 0,g=e.time;
void 0!==f&&null!==f&&void 0!==g&&null!==g&&g-f>b&&(g=f+b,a.splice(c,0,{time:g,value:0/0})),f=g}}}function e(a,b){return _.find(a,function(a){return _.isEqual(a,b)})}function f(a){var b=[];if(_.isArray(a))for(var c=0;c<a.length;++c){var d=a[c],f=_.isObject(d)&&(d.errorCode||d.errorText);if(_.isObject(d)&&_.isArray(d.error)&&d.error.length>0)for(var g=d.error,h=0;h<g.length;++h){var i=g[h];if(_.isObject(i)&&(i.errorCode||i.errorText)){var j={errorCode:i.errorCode,errorText:i.errorText,extension:d};e(b,j)||b.push(j)}else f=!0}else f=!0;if(f){var k={errorCode:_.isObject(d)?d.errorCode:void 0,errorText:_.isObject(d)&&_.isString(d.errorText)?d.errorText:m,extension:d};e(b,k)||b.push(k)}}return b}function g(a,b,e){var f={data:b?{}:void 0,errors:e};return b&&_.each(b.locations,function(e){var g=c(a,e.info.name,e.info.region);f.data[g]||(f.data[g]={}),_.each(e.data,function(c,h){f.data[g][h]||(f.data[g][h]=[]),d(c.timeValuePairs,a.resolution),_.each(c.timeValuePairs,function(a){var d={info:b.info,properties:b.properties,locationInfo:e.info,blockProperty:c.property,timeValuePair:a};f.data[g][h].push(d)})})}),f}function h(a,b,c){var d={data:b?{info:void 0,properties:void 0,locations:[]}:void 0,errors:f(c)};return b&&_.each(b.data,function(a){var b={info:void 0,data:{}};_.each(a,function(a,c){var e={property:void 0,timeValuePairs:[]};_.each(a,function(a){a&&(d.data.info||(d.data.info=a.info),d.data.properties||(d.data.properties=a.properties),e.property||(e.property=a.blockProperty),b.info||(b.info=a.locationInfo),e.timeValuePairs.push(a.timeValuePair))}),b.data[c]=e}),d.data.locations.push(b)}),d}function i(a,b,c){fi.fmi.metoclient.metolib.WfsRequestParser.getData({url:a.connectionUrl,storedQueryId:a.storedQueryId,requestParameter:b.parameter,begin:b.start,end:b.end,timestep:b.resolution,denyTimeAdjusting:!0,sites:b.location,callback:function(d,e){var f=g.call(a,b,d,e);c(f.errors,f.data)}})}var j="parserSites",k=",",l=" ",m="ERROR: Cache found error(s)!",n=function(a){if(a.timestep&&1!==a.timestep){var c=a.begin,d=a.end,e=a.timestep;a.denyTimeAdjusting||(c=fi.fmi.metoclient.metolib.WfsRequestParser.adjustBeginTime(e,c),d=fi.fmi.metoclient.metolib.WfsRequestParser.adjustEndTime(e,d,c));var f={service:j,parameter:_.isString(a.requestParameter)?a.requestParameter.split(k):a.requestParameter,start:c instanceof Date?c.getTime():c,end:d instanceof Date?d.getTime():d,resolution:e,location:b(a.sites)};this.cache.fetch(f,function(b,c){var d=h(f,c,b);a.callback(d.data,d.errors)},a.progressCallback)}else{var g=this;fi.fmi.metoclient.metolib.WfsRequestParser.getData({url:g.connectionUrl,storedQueryId:g.storedQueryId,requestParameter:a.requestParameter,begin:a.begin,end:a.end,timestep:a.timestep,denyTimeAdjusting:a.denyTimeAdjusting,sites:b(a.sites),callback:a.callback})}},o=function(a){var b=this;fi.fmi.metoclient.metolib.WfsRequestParser.getData({url:b.connectionUrl,storedQueryId:b.storedQueryId,requestParameter:a.requestParameter,begin:a.begin,end:a.end,timestep:a.timestep,denyTimeAdjusting:a.denyTimeAdjusting,bbox:a.bbox,callback:a.callback})},p=function(a,b){var c=!0;try{var d=Array.prototype.slice.call(arguments);d.shift(),d.shift(),a.apply(this,d)}catch(e){var f="ERROR: API level error occurred in a synchronous flow!";if(console.error(f),c=!1,b){var g={errorText:f};b(void 0,g)}}return c},q=function(){return this.connectionUrl},r=function(){return this.storedQueryId},s=function(a,b){if(!this.connectionUrl){if(!_.isString(a)||!a){var c="ERROR: WfsConnection URL must be a string and not empty!";throw console.error(c),c}if(!_.isString(b)||!b){var d="ERROR: WfsConnection stored query ID must be a string and not empty!";throw console.error(d),d}this.connectionUrl=a,this.storedQueryId=b}},t=function(){this.connectionUrl=void 0,this.storedQueryId=void 0,u.call(this)},u=function(){this.cache.clearCache()},v=function(a){if(!a){var b="ERROR: Options object is mandatory!";throw console.error(b),b}if(a.sites)n.call(this,a);else{if(!a.bbox){var c="ERROR: Either sites or bbox is mandatory in options!";throw console.error(c),c}o.call(this,a)}},w=function(){var a=this,b={connectionInstance:a,connectionUrl:void 0,storedQueryId:void 0,cache:new fi.fmi.metoclient.metolib.SplitterCache({sideFetchAfterFactor:1,sideFetchBeforeFactor:.5,maxBlockDataPoints:200,maxCacheDataSize:4e3})};b.cache.addDataProvider(j,function(a,c){i(b,a,c)}),this.getUrl=function(){return q.call(b)},this.getStoredQueryId=function(){return r.call(b)},this.connect=function(a,c){return p.call(b,s,void 0,a,c)},this.disconnect=function(){return p.call(b,t,void 0)},this.resetCache=function(){return p.call(b,u,void 0)},this.getData=function(a){return p.call(b,v,a?a.callback:void 0,a)}};return w}();